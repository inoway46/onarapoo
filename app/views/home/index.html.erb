<h3>おなら神経衰弱（β版）</h3>
<p>猫をクリックすると音が鳴ります。同じ音を連続して選ぶと猫が消えます。</p>
<p>※大音量だと恥ずかしい思いするので注意してね</p>
<% 2.times do %>
  <% (1..5).each do |i| %>
    <%= image_tag 'cathip.jpeg', class: "beeper#{i}", width: "100", height: "100" %>
  <% end %>
<% end %>
<div class="modal js-modal">
  <div class="modal__bg js-modal-close"></div>
  <div class="modal__content">
    <p>クリアしました！</p><br>
    <%= image_tag 'cat.png', width: "40%", height: "40%" %><br>
    <a class="replay" href="">もう1度プレイする</a><br><br>
    <a class="js-modal-close" href="">閉じる</a>
  </div>
</div>

<style>
.modal{
    display: none;
    height: 100vh;
    position: fixed;
    top: 0;
    width: 100%;
}
.modal__bg{
    background: rgba(0,0,0,0.8);
    height: 100vh;
    position: absolute;
    width: 100%;
}
.modal__content{
    text-align: center;
    background: #fff;
    left: 50%;
    padding: 40px;
    position: absolute;
    top: 50%;
    transform: translate(-50%,-50%);
    width: 60%;
}
</style>

<script>
const audio1 = new Audio('<%= asset_path "audio1.mp3" %>');
const audio2 = new Audio('<%= asset_path "audio2.mp3" %>');
const audio3 = new Audio('<%= asset_path "audio3.mp3" %>');
const audio4 = new Audio('<%= asset_path "audio4.mp3" %>');
const audio5 = new Audio('<%= asset_path "audio5.mp3" %>');
var types = [];
var score = 5;

document.addEventListener('click', (event)=>{
  let el = event.target;
  if (el.matches('.beeper1')) {
    audio1.play();
    types.push(1);
    console.log(types);
    $("[class^='beeper']").css({ 'pointer-events' : 'auto' });
    $(el).css({ 'pointer-events' : 'none' });
  }
  if (el.matches('.beeper2')) {
    audio2.play();
    types.push(2);
    console.log(types);
    $("[class^='beeper']").css({ 'pointer-events' : 'auto' });
    $(el).css({ 'pointer-events' : 'none' });
  }
  if (el.matches('.beeper3')) {
    audio3.play();
    types.push(3);
    console.log(types);
    $("[class^='beeper']").css({ 'pointer-events' : 'auto' });
    $(el).css({ 'pointer-events' : 'none' });
  }
  if (el.matches('.beeper4')) {
    audio4.play();
    types.push(4);
    console.log(types);
    $("[class^='beeper']").css({ 'pointer-events' : 'auto' });
    $(el).css({ 'pointer-events' : 'none' });
  }
  if (el.matches('.beeper5')) {
    audio5.play();
    types.push(5);
    console.log(types);
    $("[class^='beeper']").css({ 'pointer-events' : 'auto' });
    $(el).css({ 'pointer-events' : 'none' });
  }
  if (types.length == 3) {
      types.shift();
  }
  if (types[0] == types[1]) {
    if (types[0] == 1) {
      $('.beeper1').fadeOut(500, function() {
        $(this).remove();
      });
      score -= 1;
      console.log(score);
    }
    if (types[0] == 2) {
      $('.beeper2').fadeOut(500, function() {
        $(this).remove();
      });
      score -= 1;
      console.log(score);
    }
    if (types[0] == 3) {
      $('.beeper3').fadeOut(500, function() {
        $(this).remove();
      });
      score -= 1;
      console.log(score);
    }
    if (types[0] == 4) {
      $('.beeper4').fadeOut(500, function() {
        $(this).remove();
      });
      score -= 1;
      console.log(score);
    }
    if (types[0] == 5) {
      $('.beeper5').fadeOut(500, function() {
        $(this).remove();
      });
      score -= 1;
      console.log(score);
    }
  }
  if (score == 0) {
  $('.js-modal').fadeIn();
  }
});

$('.js-modal-close').on('click',function(){
  $('.js-modal').fadeOut();
  return false;
});

$('.replay').on('click', function(){
  location.reload();
});
</script>
